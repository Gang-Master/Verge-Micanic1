<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù„Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„Ø´Ø±Ø·ÙŠØ©</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --admin-color: #e74c3c;
            --editor-color: #f39c12;
            --viewer-color: #27ae60;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        
        .sidebar {
            height: 100vh;
            position: fixed;
            right: 0;
            top: 0;
            background-color: var(--primary-color);
            color: white;
            padding-top: 20px;
            width: 250px;
            transition: all 0.3s;
            z-index: 1000;
            overflow-y: auto;
        }
        
        .main-content {
            margin-right: 250px;
            padding: 20px;
            transition: all 0.3s;
            min-height: 100vh;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                margin-right: -250px;
            }
            .sidebar.active {
                margin-right: 0;
            }
            .main-content {
                margin-right: 0;
            }
        }
        
        .sidebar a {
            color: white;
            text-decoration: none;
            display: block;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }
        
        .sidebar a:hover {
            background-color: rgba(255,255,255,0.1);
            padding-right: 25px;
        }
        
        .sidebar a.active {
            background-color: var(--secondary-color);
            border-right: 4px solid white;
        }
        
        .user-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        
        .badge-admin { background-color: var(--admin-color); }
        .badge-editor { background-color: var(--editor-color); }
        .badge-viewer { background-color: var(--viewer-color); }
        
        .section-title {
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
            margin-bottom: 30px;
            color: var(--primary-color);
        }
        
        .login-container {
            max-width: 500px;
            margin: 100px auto;
            padding: 30px;
            border-radius: 10px;
            background-color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .logo {
            font-weight: bold;
            font-size: 24px;
            color: var(--primary-color);
            text-align: center;
        }
        
        .logo span { color: var(--secondary-color); }
        
        .vehicle-card {
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s;
            height: 100%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .vehicle-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        
        .vehicle-img-container {
            height: 200px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f5f5f5;
        }
        
        .vehicle-img {
            max-height: 100%;
            max-width: 100%;
            object-fit: cover;
        }
        
        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-block;
            margin: 0 5px;
            border: 1px solid #ddd;
            cursor: pointer;
        }
        
        .color-preview:hover {
            transform: scale(1.1);
            border-color: #007bff;
        }
        
        .copy-btn {
            cursor: pointer;
            transition: all 0.3s;
            color: #6c757d;
        }
        
        .copy-btn:hover {
            transform: scale(1.1);
            color: #007bff;
        }
        
        .rank-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            color: #1565c0;
            margin: 2px;
            font-weight: bold;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
            justify-content: flex-end;
        }
        
        .dashboard-card {
            border-radius: 10px;
            padding: 20px;
            color: white;
            margin-bottom: 20px;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .dashboard-card:hover { transform: translateY(-3px); }
        .card-admin { background: linear-gradient(135deg, var(--admin-color), #c0392b); }
        .card-editor { background: linear-gradient(135deg, var(--editor-color), #d35400); }
        .card-viewer { background: linear-gradient(135deg, var(--viewer-color), #229954); }
        .card-vehicles { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        
        .toggle-sidebar {
            display: none;
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 1001;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 15px;
        }
        
        @media (max-width: 768px) {
            .toggle-sidebar {
                display: block;
            }
        }
        
        .firebase-status {
            position: fixed;
            bottom: 10px;
            left: 10px;
            z-index: 1000;
            font-size: 12px;
        }
        
        .status-connected {
            color: #28a745;
        }
        
        .status-disconnected {
            color: #dc3545;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }
    </style>
</head>
<body>
    <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="login-page" class="login-container">
        <div class="text-center mb-4">
            <h1 class="logo">Ù†Ø¸Ø§Ù… <span>Ø§Ù„Ø¨Ø­Ø«</span> Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h1>
            <p class="text-muted">Ø¥Ø¯Ø§Ø±Ø© ÙˆØªØµÙØ­ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„Ø´Ø±Ø·ÙŠØ©</p>
            <div class="mt-3">
                <i class="fas fa-car fa-3x text-primary mb-3"></i>
            </div>
        </div>
        
        <div class="mb-3">
            <label for="login-email" class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <div class="input-group">
                <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                <input type="email" class="form-control" id="login-email" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            </div>
        </div>
        
        <div class="mb-3">
            <label for="login-password" class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <div class="input-group">
                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                <input type="password" class="form-control" id="login-password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
        </div>
        
        <div class="d-grid gap-2 mt-4">
            <button class="btn btn-primary btn-lg" onclick="login()">
                <i class="fas fa-sign-in-alt me-2"></i>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            </button>
            <button class="btn btn-outline-secondary mt-2" onclick="loginAsDemoAdmin()">
                <i class="fas fa-user-shield me-2"></i>Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ± ØªØ¬Ø±ÙŠØ¨ÙŠ
            </button>
        </div>
        
        <div id="login-error" class="alert alert-danger mt-3 d-none"></div>
        
        <div class="mt-4 text-center">
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©:</strong> admin@test.com / 123456
            </div>
        </div>
        
        <div class="firebase-status" id="firebase-status">
            <i class="fas fa-circle status-disconnected"></i>
            <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
        </div>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
    <div id="dashboard" class="d-none">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
        <button class="toggle-sidebar" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        
        <div class="sidebar" id="sidebar">
            <div class="text-center mb-4 px-3">
                <div class="mb-3">
                    <i class="fas fa-car fa-3x text-white"></i>
                </div>
                <h2 class="logo mb-2" style="font-size: 20px;">Ù†Ø¸Ø§Ù… <span>Ø§Ù„Ø¨Ø­Ø«</span></h2>
                <p class="text-light small mb-2" id="user-info">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ </p>
                <span class="user-badge" id="user-role-badge">Ù…Ø¯ÙŠØ±</span>
                <div class="mt-2">
                    <small class="text-light" id="firebase-sync-status">
                        <i class="fas fa-sync-alt"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...
                    </small>
                </div>
            </div>
            
            <div class="sidebar-menu">
                <a href="#" class="active" onclick="showSection('dashboard-home')">
                    <i class="fas fa-home me-2"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </a>
                
                <a href="#" onclick="showSection('search-vehicles')">
                    <i class="fas fa-search me-2"></i> Ø¨Ø­Ø« Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª
                </a>
                
                <a href="#" onclick="showSection('add-vehicle')" id="add-vehicle-link">
                    <i class="fas fa-car me-2"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ¨Ø©
                </a>
                
                <a href="#" onclick="showSection('manage-sectors')" id="manage-sectors-link">
                    <i class="fas fa-list me-2"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª
                </a>
                
                <a href="#" onclick="showSection('manage-ranks')" id="manage-ranks-link">
                    <i class="fas fa-user-tie me-2"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ØªØ¨
                </a>
                
                <a href="#" onclick="showSection('manage-colors')" id="manage-colors-link">
                    <i class="fas fa-palette me-2"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†
                </a>
                
                <a href="#" onclick="showSection('manage-users')" id="manage-users-link">
                    <i class="fas fa-users me-2"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                </a>
                
                <a href="#" onclick="showSection('system-tools')" id="system-tools-link">
                    <i class="fas fa-tools me-2"></i> Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
                </a>
            </div>
            
            <div class="mt-auto">
                <a href="#" onclick="logout()" class="text-center" style="background-color: rgba(255,255,255,0.1);">
                    <i class="fas fa-sign-out-alt me-2"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                </a>
            </div>
        </div>
        
        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="main-content" id="main-content">
            <!-- ========== Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ========== -->
            <div id="dashboard-home" class="dashboard-section">
                <h2 class="section-title">
                    <i class="fas fa-tachometer-alt me-2"></i>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </h2>
                
                <div class="row">
                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-admin">
                            <i class="fas fa-user-shield"></i>
                            <h4>Ø§Ù„Ù…Ø¯ÙŠØ±ÙˆÙ†</h4>
                            <h2 id="admin-count">0</h2>
                        </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-editor">
                            <i class="fas fa-edit"></i>
                            <h4>Ø§Ù„Ù…Ø­Ø±Ø±ÙˆÙ†</h4>
                            <h2 id="editor-count">0</h2>
                        </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-viewer">
                            <i class="fas fa-eye"></i>
                            <h4>Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙˆÙ†</h4>
                            <h2 id="viewer-count">0</h2>
                        </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-vehicles">
                            <i class="fas fa-car"></i>
                            <h4>Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</h4>
                            <h2 id="vehicle-count">0</h2>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="fas fa-history me-2 text-primary"></i>Ø¢Ø®Ø± Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©
                                </h5>
                                <div id="recent-vehicles" class="mt-3">
                                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="fas fa-chart-bar me-2 text-success"></i>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
                                </h5>
                                <canvas id="stats-chart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="fas fa-database me-2 text-info"></i>Ø­Ø§Ù„Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                                </h5>
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <div class="d-flex align-items-center">
                                            <div class="me-3">
                                                <i class="fas fa-car fa-2x text-primary"></i>
                                            </div>
                                            <div>
                                                <h6 class="mb-0">Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</h6>
                                                <small id="db-vehicles-status" class="text-muted">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="d-flex align-items-center">
                                            <div class="me-3">
                                                <i class="fas fa-users fa-2x text-success"></i>
                                            </div>
                                            <div>
                                                <h6 class="mb-0">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h6>
                                                <small id="db-users-status" class="text-muted">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="d-flex align-items-center">
                                            <div class="me-3">
                                                <i class="fas fa-sync-alt fa-2x text-warning"></i>
                                            </div>
                                            <div>
                                                <h6 class="mb-0">Ø§Ù„Ø­Ø§Ù„Ø©</h6>
                                                <small id="db-connection-status" class="text-muted">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ========== Ù‚Ø³Ù… Ø§Ù„Ø¨Ø­Ø« ========== -->
            <div id="search-vehicles" class="dashboard-section d-none">
                <h2 class="section-title">
                    <i class="fas fa-search me-2"></i>Ø¨Ø­Ø« Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª
                </h2>
                
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3">
                            <i class="fas fa-filter me-2 text-primary"></i>ÙÙ„ØªØ± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
                        </h5>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label fw-bold">Ø§Ù„Ù‚Ø·Ø§Ø¹ *</label>
                                <select class="form-control" id="search-sector" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø·Ø§Ø¹</option>
                                </select>
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label class="form-label fw-bold">Ø§Ù„Ø±ØªØ¨Ø© *</label>
                                <select class="form-control" id="search-rank" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø±ØªØ¨Ø©</option>
                                </select>
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label class="form-label fw-bold">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</label>
                                <select class="form-control" id="search-type">
                                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                                    <option value="Ø§Ù„ÙÙˆØ±Ø¯ ÙÙƒØªÙˆØ±ÙŠØ§">Ø§Ù„ÙÙˆØ±Ø¯ ÙÙƒØªÙˆØ±ÙŠØ§</option>
                                    <option value="Ø§Ù„Ø¯ÙˆØ¯Ø¬ ØªØ´Ø§Ø±Ø¬Ø±">Ø§Ù„Ø¯ÙˆØ¯Ø¬ ØªØ´Ø§Ø±Ø¬Ø±</option>
                                    <option value="ÙÙˆØ±Ø¯ Ø§ÙƒØ³Ø¨Ù„ÙˆØ±">ÙÙˆØ±Ø¯ Ø§ÙƒØ³Ø¨Ù„ÙˆØ±</option>
                                    <option value="ØªØ§Ù‡Ùˆ">ØªØ§Ù‡Ùˆ</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-3">
                            <button class="btn btn-primary px-4" onclick="searchVehicles()">
                                <i class="fas fa-search me-2"></i>Ø¨Ø­Ø«
                            </button>
                            <button class="btn btn-outline-secondary px-4" onclick="resetSearch()">
                                <i class="fas fa-redo me-2"></i>Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="row" id="search-results">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« -->
                </div>
            </div>
            
            <!-- ========== Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ¨Ø© Ø¬Ø¯ÙŠØ¯Ø© ========== -->
            <div id="add-vehicle" class="dashboard-section d-none">
                <h2 class="section-title">
                    <i class="fas fa-car me-2"></i>Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ù…Ø±ÙƒØ¨Ø©
                </h2>
                
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <form id="vehicle-form" onsubmit="saveVehicle(event)">
                            <input type="hidden" id="vehicle-id">
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© *</label>
                                    <select class="form-control" id="vehicle-type" required>
                                        <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</option>
                                        <option value="Ø§Ù„ÙÙˆØ±Ø¯ ÙÙƒØªÙˆØ±ÙŠØ§">Ø§Ù„ÙÙˆØ±Ø¯ ÙÙƒØªÙˆØ±ÙŠØ§</option>
                                        <option value="Ø§Ù„Ø¯ÙˆØ¯Ø¬ ØªØ´Ø§Ø±Ø¬Ø±">Ø§Ù„Ø¯ÙˆØ¯Ø¬ ØªØ´Ø§Ø±Ø¬Ø±</option>
                                        <option value="ÙÙˆØ±Ø¯ Ø§ÙƒØ³Ø¨Ù„ÙˆØ±">ÙÙˆØ±Ø¯ Ø§ÙƒØ³Ø¨Ù„ÙˆØ±</option>
                                        <option value="ØªØ§Ù‡Ùˆ">ØªØ§Ù‡Ùˆ</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙÙ†ÙŠ *</label>
                                    <input type="text" class="form-control" id="vehicle-code" required>
                                    <small class="text-muted">Ù…Ø«Ø§Ù„: cvpi_sign_1 Ø£Ùˆ alphatexture</small>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Ø§Ù„Ù‚Ø·Ø§Ø¹ *</label>
                                    <select class="form-control" id="vehicle-sector" required>
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø·Ø§Ø¹</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Ø§Ù„Ø±ØªØ¨Ø© *</label>
                                    <select class="form-control" id="vehicle-rank" required>
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø±ØªØ¨Ø©</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£ÙˆÙ„ *</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="vehicle-color1" placeholder="Ù…Ø«Ø§Ù„: 4c4c4c" required>
                                        <span class="input-group-text color-preview" id="color1-preview"></span>
                                        <button type="button" class="btn btn-outline-secondary" onclick="openColorPicker('vehicle-color1')">
                                            <i class="fas fa-eye-dropper"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ *</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="vehicle-color2" placeholder="Ù…Ø«Ø§Ù„: FFFFFF" required>
                                        <span class="input-group-text color-preview" id="color2-preview"></span>
                                        <button type="button" class="btn btn-outline-secondary" onclick="openColorPicker('vehicle-color2')">
                                            <i class="fas fa-eye-dropper"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <label class="form-label">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© *</label>
                                    <input type="url" class="form-control" id="vehicle-image" required>
                                    <small class="text-muted">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ https://</small>
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©</label>
                                    <button type="button" class="btn btn-outline-info w-100" onclick="previewImage()">
                                        <i class="fas fa-image"></i> Ù…Ø¹Ø§ÙŠÙ†Ø©
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                                <textarea class="form-control" id="vehicle-notes" rows="3"></textarea>
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="submit" class="btn btn-primary" id="save-vehicle-btn">
                                    <i class="fas fa-save me-2"></i>Ø­ÙØ¸ ÙÙŠ Firebase
                                </button>
                                <button type="button" class="btn btn-outline-secondary" onclick="resetVehicleForm()">
                                    <i class="fas fa-times me-2"></i>Ø¥Ù„ØºØ§Ø¡
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- ========== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª ========== -->
            <div id="manage-sectors" class="dashboard-section d-none">
                <h2 class="section-title">
                    <i class="fas fa-list me-2"></i>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª
                </h2>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-body">
                                <h5 class="card-title mb-3">
                                    <i class="fas fa-plus-circle me-2 text-success"></i>Ø¥Ø¶Ø§ÙØ© Ù‚Ø·Ø§Ø¹ Ø¬Ø¯ÙŠØ¯
                                </h5>
                                <form id="sector-form" onsubmit="saveSector(event)">
                                    <input type="hidden" id="sector-id">
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø§Ø¹ *</label>
                                        <input type="text" class="form-control" id="sector-name" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Ø±Ù…Ø² Ø§Ù„Ù‚Ø·Ø§Ø¹ *</label>
                                        <input type="text" class="form-control" id="sector-code" required>
                                        <small class="text-muted">ÙŠØ³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©</small>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Ø§Ù„ÙˆØµÙ</label>
                                        <textarea class="form-control" id="sector-description" rows="2"></textarea>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary" id="save-sector-btn">
                                            <i class="fas fa-save me-2"></i>Ø­ÙØ¸ ÙÙŠ Firebase
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title mb-3">
                                    <i class="fas fa-list-alt me-2 text-primary"></i>Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                                </h5>
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                                <th>Ø§Ù„Ø±Ù…Ø²</th>
                                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                            </tr>
                                        </thead>
                                        <tbody id="sectors-list">
                                            <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ========== Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… ========== -->
            <div id="system-tools" class="dashboard-section d-none">
                <h2 class="section-title">
                    <i class="fas fa-tools me-2"></i>Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
                </h2>
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-body text-center">
                                <i class="fas fa-database fa-3x text-warning mb-3"></i>
                                <h5 class="card-title">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</h5>
                                <p class="card-text">Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù… Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©</p>
                                <button class="btn btn-warning" onclick="loadDefaultDataToFirebase()">
                                    <i class="fas fa-cloud-upload-alt me-2"></i>Ø±ÙØ¹ Ø¥Ù„Ù‰ Firebase
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-body text-center">
                                <i class="fas fa-sync-alt fa-3x text-info mb-3"></i>
                                <h5 class="card-title">Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h5>
                                <p class="card-text">Ù…Ø²Ø§Ù…Ù†Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Firebase</p>
                                <button class="btn btn-info" onclick="syncAllData()">
                                    <i class="fas fa-sync me-2"></i>Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¢Ù†
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-body text-center">
                                <i class="fas fa-trash-alt fa-3x text-danger mb-3"></i>
                                <h5 class="card-title">Ù…Ø³Ø­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h5>
                                <p class="card-text">ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø³ØªØ²ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                                <button class="btn btn-outline-danger" onclick="clearFirebaseData()">
                                    <i class="fas fa-trash me-2"></i>Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Firebase</h5>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª:</span>
                                        <strong id="fb-vehicles-count">0</strong>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª:</span>
                                        <strong id="fb-sectors-count">0</strong>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø±ØªØ¨:</span>
                                        <strong id="fb-ranks-count">0</strong>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:</span>
                                        <strong id="fb-users-count">0</strong>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„:</span>
                                        <strong id="fb-connection-status" class="text-warning">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</strong>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h5>
                                <div class="mb-3">
                                    <label class="form-label">Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                                    <input type="text" class="form-control" value="verg-micanic" readonly>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Ø±Ø§Ø¨Ø· Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</label>
                                    <input type="text" class="form-control" value="https://verg-micanic-default-rtdb.firebaseio.com" readonly>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</label>
                                    <input type="text" class="form-control" id="last-update-time" value="Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ø¹Ø¯" readonly>
                                </div>
                                <button class="btn btn-outline-primary w-100" onclick="refreshFirebaseData()">
                                    <i class="fas fa-redo me-2"></i>ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ù…Ø®ØªØµØ±Ø©) -->
            <div id="manage-ranks" class="dashboard-section d-none">
                <h2 class="section-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ØªØ¨</h2>
                <div class="alert alert-info">Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ± - Ø³ÙŠØ¹Ù…Ù„ Ù…Ø¹ Firebase</div>
            </div>
            
            <div id="manage-colors" class="dashboard-section d-none">
                <h2 class="section-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†</h2>
                <div class="alert alert-info">Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ± - Ø³ÙŠØ¹Ù…Ù„ Ù…Ø¹ Firebase</div>
            </div>
            
            <div id="manage-users" class="dashboard-section d-none">
                <h2 class="section-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
                <div class="alert alert-info">Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ± - Ø³ÙŠØ¹Ù…Ù„ Ù…Ø¹ Firebase</div>
            </div>
        </div>
    </div>

    <!-- Ù…ÙƒØªØ¨Ø§Øª Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCg3Dmf_Odgfm2IL1IZXr_Kl16IaqiWqso",
            authDomain: "verg-micanic.firebaseapp.com",
            databaseURL: "https://verg-micanic-default-rtdb.firebaseio.com",
            projectId: "verg-micanic",
            storageBucket: "verg-micanic.firebasestorage.app",
            messagingSenderId: "881689454596",
            appId: "1:881689454596:web:e630ad9f555ba8feabed51",
            measurementId: "G-B9JZ3CR9GS"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        let currentUser = null;
        let userRole = null;
        let vehicles = [];
        let sectors = [];
        let ranks = [];
        let users = [];
        let firebaseInitialized = true;
        let chart = null;
        let dataListeners = [];

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        const defaultData = {
            sectors: [
                { name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±Ø·Ø©', code: 'police', description: 'Ù…Ø±ÙƒØ¨Ø§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±Ø·Ø©' },
                { name: 'Ø£Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ù†Ø¦', code: 'ports', description: 'Ù…Ø±ÙƒØ¨Ø§Øª Ø£Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ù†Ø¦' },
                { name: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©', code: 'health', description: 'Ù…Ø±ÙƒØ¨Ø§Øª ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©' }
            ],
            ranks: [
                { name: 'Ù…Ù„Ø§Ø²Ù…', code: 'lieutenant', description: 'Ø±ØªØ¨Ø© Ù…Ù„Ø§Ø²Ù…' },
                { name: 'Ù†Ù‚ÙŠØ¨', code: 'captain', description: 'Ø±ØªØ¨Ø© Ù†Ù‚ÙŠØ¨' },
                { name: 'Ø±Ø§Ø¦Ø¯', code: 'major', description: 'Ø±ØªØ¨Ø© Ø±Ø§Ø¦Ø¯' },
                { name: 'Ù…Ù‚Ø¯Ù…', code: 'lt-colonel', description: 'Ø±ØªØ¨Ø© Ù…Ù‚Ø¯Ù…' },
                { name: 'Ø¹Ù‚ÙŠØ¯', code: 'colonel', description: 'Ø±ØªØ¨Ø© Ø¹Ù‚ÙŠØ¯' }
            ],
            users: [
                {
                    name: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ',
                    email: 'admin@test.com',
                    role: 'admin',
                    permissions: ['all'],
                    createdAt: new Date().toISOString()
                }
            ],
            vehicles: [
                {
                    type: 'ØªØ§Ù‡Ùˆ',
                    code: 'rematahoe15',
                    sector: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±Ø·Ø©',
                    rank: 'Ù†Ù‚ÙŠØ¨',
                    color1: '4c4c4c',
                    color2: 'FFFFFF',
                    image: 'https://i.epvpimg.com/zr6gaab.png',
                    notes: 'ØªØ§Ù‡Ùˆ Ù‚ÙŠØ§Ø¯Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±Ø·Ø©'
                },
                {
                    type: 'Ø§Ù„ÙÙˆØ±Ø¯ ÙÙƒØªÙˆØ±ÙŠØ§',
                    code: 'cvpi_sign_1',
                    sector: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±Ø·Ø©',
                    rank: 'Ø±Ø§Ø¦Ø¯',
                    color1: '4c4c4c',
                    color2: 'FFFFFF',
                    image: 'https://i.epvpimg.com/R59idab.png',
                    notes: 'ÙÙˆØ±Ø¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±Ø·Ø©'
                },
                {
                    type: 'ÙÙˆØ±Ø¯ Ø§ÙƒØ³Ø¨Ù„ÙˆØ±',
                    code: 'remap16expl',
                    sector: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±Ø·Ø©',
                    rank: 'Ù…Ù„Ø§Ø²Ù…',
                    color1: '4c4c4c',
                    color2: 'FFFFFF',
                    image: 'https://i.epvpimg.com/e3hDdab.png',
                    notes: 'ÙÙˆØ±Ø¯ Ø§ÙƒØ³Ø¨Ù„ÙˆØ± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±Ø·Ø©'
                },
                {
                    type: 'Ø§Ù„Ø¯ÙˆØ¯Ø¬ ØªØ´Ø§Ø±Ø¬Ø±',
                    code: 'alphatexture',
                    sector: 'Ø£Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ù†Ø¦',
                    rank: 'Ù…Ù‚Ø¯Ù…',
                    color1: '99d24f',
                    color2: 'FFFFFF',
                    image: 'https://i.epvpimg.com/aPQtdab.png',
                    notes: 'Ø¯ÙˆØ¯Ø¬ Ø£Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ù†Ø¦'
                },
                {
                    type: 'ØªØ§Ù‡Ùˆ',
                    code: 'rematahoe15',
                    sector: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©',
                    rank: 'Ø¹Ù‚ÙŠØ¯',
                    color1: '880000',
                    color2: '880000',
                    image: 'https://i.epvpimg.com/Ay3Hbab.jpg',
                    notes: 'ØªØ§Ù‡Ùˆ ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©'
                }
            ]
        };

        // Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„');
            console.log('ğŸ”¥ Firebase Ù…Ù‡ÙŠØ£: ', firebaseInitialized);
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
            updateConnectionStatus();
            
            // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§ØªØµØ§Ù„ Firebase
            monitorFirebaseConnection();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            setupEventListeners();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            checkAuthState();
        });

        // ========== Ø¯ÙˆØ§Ù„ Firebase ==========
        function monitorFirebaseConnection() {
            const connectedRef = database.ref('.info/connected');
            
            connectedRef.on('value', (snapshot) => {
                const isConnected = snapshot.val();
                updateConnectionStatus(isConnected);
                
                if (isConnected) {
                    console.log('âœ… Ù…ØªØµÙ„ Ø¨Ù€ Firebase');
                    updateFirebaseStatus('connected');
                } else {
                    console.log('âŒ ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ù€ Firebase');
                    updateFirebaseStatus('disconnected');
                }
            });
        }

        function updateConnectionStatus(isConnected = null) {
            const statusElement = document.getElementById('firebase-status');
            if (!statusElement) return;
            
            if (isConnected === null) {
                statusElement.innerHTML = '<i class="fas fa-circle text-warning"></i> <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>';
                return;
            }
            
            if (isConnected) {
                statusElement.innerHTML = '<i class="fas fa-circle status-connected"></i> <span>Ù…ØªØµÙ„ Ø¨Ù€ Firebase</span>';
                statusElement.className = 'firebase-status status-connected';
            } else {
                statusElement.innerHTML = '<i class="fas fa-circle status-disconnected"></i> <span>ØºÙŠØ± Ù…ØªØµÙ„</span>';
                statusElement.className = 'firebase-status status-disconnected';
            }
        }

        function updateFirebaseStatus(status) {
            const elements = {
                'firebase-sync-status': document.getElementById('firebase-sync-status'),
                'db-connection-status': document.getElementById('db-connection-status'),
                'fb-connection-status': document.getElementById('fb-connection-status')
            };
            
            const statusTexts = {
                'connected': { text: 'Ù…ØªØµÙ„', class: 'text-success' },
                'disconnected': { text: 'ØºÙŠØ± Ù…ØªØµÙ„', class: 'text-danger' },
                'syncing': { text: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...', class: 'text-warning' },
                'error': { text: 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', class: 'text-danger' }
            };
            
            for (const [id, element] of Object.entries(elements)) {
                if (element && statusTexts[status]) {
                    element.textContent = statusTexts[status].text;
                    element.className = statusTexts[status].class;
                }
            }
        }

        // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ==========
        function checkAuthState() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    console.log('ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„:', user.email);
                    currentUser = user;
                    loadUserData(user.uid);
                } else {
                    console.log('ğŸ‘¤ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„');
                    showLogin();
                }
            });
        }

        function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorElement = document.getElementById('login-error');
            
            if (!email || !password) {
                showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
                return;
            }
            
            showLoading('Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...');
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    hideLoading();
                    showToast('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    loadUserData(userCredential.user.uid);
                })
                .catch((error) => {
                    hideLoading();
                    console.error('âŒ Ø®Ø·Ø£ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
                    
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£ Ø¨Ø³Ø¨Ø¨ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                    if (error.code === 'auth/user-not-found') {
                        createUser(email, password);
                    } else {
                        const errorMsg = getAuthErrorMessage(error.code);
                        showError(errorMsg);
                    }
                });
        }

        function createUser(email, password) {
            showLoading('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯...');
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    const userData = {
                        name: email.split('@')[0],
                        email: email,
                        role: 'admin',
                        permissions: ['all'],
                        createdAt: new Date().toISOString(),
                        createdBy: 'system'
                    };
                    
                    return database.ref('users/' + user.uid).set(userData);
                })
                .then(() => {
                    hideLoading();
                    showToast('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    checkAuthState();
                })
                .catch((error) => {
                    hideLoading();
                    const errorMsg = getAuthErrorMessage(error.code);
                    showError(errorMsg);
                });
        }

        function loginAsDemoAdmin() {
            const email = 'admin@test.com';
            const password = '123456';
            
            document.getElementById('login-email').value = email;
            document.getElementById('login-password').value = password;
            login();
        }

        function logout() {
            // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
            removeAllListeners();
            
            auth.signOut()
                .then(() => {
                    currentUser = null;
                    userRole = null;
                    showLogin();
                    showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'info');
                })
                .catch((error) => {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:', error);
                });
        }

        function removeAllListeners() {
            dataListeners.forEach(listener => {
                if (listener && typeof listener === 'function') {
                    listener();
                }
            });
            dataListeners = [];
        }

        // ========== Ø¯ÙˆØ§Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==========
        function loadUserData(userId) {
            showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…...');
            
            database.ref('users/' + userId).once('value')
                .then((snapshot) => {
                    const userData = snapshot.val();
                    
                    if (userData) {
                        userRole = userData.role;
                        currentUser.data = userData;
                        
                        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                        document.getElementById('user-info').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${userData.name}`;
                        document.getElementById('user-role-badge').textContent = getRoleName(userData.role);
                        document.getElementById('user-role-badge').className = `user-badge badge-${userData.role}`;
                        
                        // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
                        updatePermissions(userData.role);
                        
                        // Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                        showDashboard();
                        
                        // ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        loadAllData();
                    } else {
                        // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
                        createUserData(userId);
                    }
                })
                .catch((error) => {
                    hideLoading();
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                    showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                });
        }

        function createUserData(userId) {
            const userData = {
                name: currentUser.email.split('@')[0],
                email: currentUser.email,
                role: 'admin',
                permissions: ['all'],
                createdAt: new Date().toISOString(),
                createdBy: 'system'
            };
            
            database.ref('users/' + userId).set(userData)
                .then(() => {
                    loadUserData(userId);
                })
                .catch((error) => {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                });
        }

        function loadAllData() {
            showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase...');
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
            const promises = [
                setupVehiclesListener(),
                setupSectorsListener(),
                setupRanksListener(),
                setupUsersListener()
            ];
            
            Promise.all(promises)
                .then(() => {
                    hideLoading();
                    showToast('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    updateFirebaseStatus('connected');
                    updateDashboard();
                })
                .catch((error) => {
                    hideLoading();
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                    showToast('âš ï¸ Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
                });
        }

        function setupVehiclesListener() {
            return new Promise((resolve) => {
                const vehiclesRef = database.ref('vehicles');
                
                const listener = vehiclesRef.on('value', (snapshot) => {
                    vehicles = [];
                    if (snapshot.exists()) {
                        snapshot.forEach((childSnapshot) => {
                            vehicles.push({
                                id: childSnapshot.key,
                                ...childSnapshot.val()
                            });
                        });
                    }
                    
                    console.log(`ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ ${vehicles.length} Ù…Ø±ÙƒØ¨Ø© Ù…Ù† Firebase`);
                    document.getElementById('vehicle-count').textContent = vehicles.length;
                    document.getElementById('fb-vehicles-count').textContent = vehicles.length;
                    document.getElementById('db-vehicles-status').textContent = `${vehicles.length} Ù…Ø±ÙƒØ¨Ø©`;
                    
                    updateRecentVehicles();
                    updateChart();
                    
                    resolve();
                });
                
                dataListeners.push(() => vehiclesRef.off('value', listener));
            });
        }

        function setupSectorsListener() {
            return new Promise((resolve) => {
                const sectorsRef = database.ref('sectors');
                
                const listener = sectorsRef.on('value', (snapshot) => {
                    sectors = [];
                    if (snapshot.exists()) {
                        snapshot.forEach((childSnapshot) => {
                            sectors.push({
                                id: childSnapshot.key,
                                ...childSnapshot.val()
                            });
                        });
                    }
                    
                    console.log(`ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ ${sectors.length} Ù‚Ø·Ø§Ø¹ Ù…Ù† Firebase`);
                    document.getElementById('fb-sectors-count').textContent = sectors.length;
                    updateDropdowns();
                    updateSectorsList();
                    
                    resolve();
                });
                
                dataListeners.push(() => sectorsRef.off('value', listener));
            });
        }

        function setupRanksListener() {
            return new Promise((resolve) => {
                const ranksRef = database.ref('ranks');
                
                const listener = ranksRef.on('value', (snapshot) => {
                    ranks = [];
                    if (snapshot.exists()) {
                        snapshot.forEach((childSnapshot) => {
                            ranks.push({
                                id: childSnapshot.key,
                                ...childSnapshot.val()
                            });
                        });
                    }
                    
                    console.log(`ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ ${ranks.length} Ø±ØªØ¨Ø© Ù…Ù† Firebase`);
                    document.getElementById('fb-ranks-count').textContent = ranks.length;
                    updateDropdowns();
                    
                    resolve();
                });
                
                dataListeners.push(() => ranksRef.off('value', listener));
            });
        }

        function setupUsersListener() {
            return new Promise((resolve) => {
                const usersRef = database.ref('users');
                
                const listener = usersRef.on('value', (snapshot) => {
                    users = [];
                    if (snapshot.exists()) {
                        snapshot.forEach((childSnapshot) => {
                            users.push({
                                id: childSnapshot.key,
                                ...childSnapshot.val()
                            });
                        });
                    }
                    
                    console.log(`ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ ${users.length} Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firebase`);
                    document.getElementById('fb-users-count').textContent = users.length;
                    document.getElementById('db-users-status').textContent = `${users.length} Ù…Ø³ØªØ®Ø¯Ù…`;
                    
                    updateDashboardStats();
                    
                    resolve();
                });
                
                dataListeners.push(() => usersRef.off('value', listener));
            });
        }

        // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Firebase ==========
        function saveVehicle(event) {
            event.preventDefault();
            
            if (!currentUser) {
                showToast('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            const vehicleId = document.getElementById('vehicle-id').value;
            const type = document.getElementById('vehicle-type').value;
            const code = document.getElementById('vehicle-code').value;
            const sector = document.getElementById('vehicle-sector').value;
            const rank = document.getElementById('vehicle-rank').value;
            const color1 = document.getElementById('vehicle-color1').value.replace('#', '');
            const color2 = document.getElementById('vehicle-color2').value.replace('#', '');
            const image = document.getElementById('vehicle-image').value;
            const notes = document.getElementById('vehicle-notes').value;
            
            if (!type || !code || !sector || !rank || !color1 || !color2 || !image) {
                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }
            
            const vehicleData = {
                type,
                code,
                sector,
                rank,
                color1,
                color2,
                image,
                notes: notes || '',
                updatedAt: new Date().toISOString(),
                updatedBy: currentUser.uid
            };
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© ÙÙŠ Firebase...');
            
            if (vehicleId) {
                // ØªØ¹Ø¯ÙŠÙ„ Ù…Ø±ÙƒØ¨Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©
                vehicleData.createdAt = document.getElementById('vehicle-created-at')?.value || new Date().toISOString();
                vehicleData.createdBy = document.getElementById('vehicle-created-by')?.value || currentUser.uid;
                
                database.ref('vehicles/' + vehicleId).update(vehicleData)
                    .then(() => {
                        hideLoading();
                        showToast('âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Firebase', 'success');
                        resetVehicleForm();
                        updateLastUpdateTime();
                    })
                    .catch((error) => {
                        hideLoading();
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©:', error);
                        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                    });
            } else {
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
                vehicleData.createdAt = new Date().toISOString();
                vehicleData.createdBy = currentUser.uid;
                
                database.ref('vehicles').push(vehicleData)
                    .then((ref) => {
                        hideLoading();
                        showToast('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Firebase', 'success');
                        resetVehicleForm();
                        updateLastUpdateTime();
                    })
                    .catch((error) => {
                        hideLoading();
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©:', error);
                        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                    });
            }
        }

        function saveSector(event) {
            event.preventDefault();
            
            if (!currentUser) {
                showToast('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            const sectorId = document.getElementById('sector-id').value;
            const name = document.getElementById('sector-name').value;
            const code = document.getElementById('sector-code').value;
            const description = document.getElementById('sector-description').value;
            
            if (!name || !code) {
                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }
            
            const sectorData = {
                name,
                code,
                description: description || '',
                updatedAt: new Date().toISOString(),
                updatedBy: currentUser.uid
            };
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ù‚Ø·Ø§Ø¹ ÙÙŠ Firebase...');
            
            if (sectorId) {
                database.ref('sectors/' + sectorId).update(sectorData)
                    .then(() => {
                        hideLoading();
                        showToast('âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Firebase', 'success');
                        resetSectorForm();
                        updateLastUpdateTime();
                    })
                    .catch((error) => {
                        hideLoading();
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø·Ø§Ø¹:', error);
                        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                    });
            } else {
                sectorData.createdAt = new Date().toISOString();
                sectorData.createdBy = currentUser.uid;
                
                database.ref('sectors').push(sectorData)
                    .then(() => {
                        hideLoading();
                        showToast('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Firebase', 'success');
                        resetSectorForm();
                        updateLastUpdateTime();
                    })
                    .catch((error) => {
                        hideLoading();
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø·Ø§Ø¹:', error);
                        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                    });
            }
        }

        // ========== Ø¯ÙˆØ§Ù„ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… ==========
        function loadDefaultDataToFirebase() {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ù„Ù‰ FirebaseØŸ')) {
                return;
            }
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ù„Ù‰ Firebase...');
            updateFirebaseStatus('syncing');
            
            const promises = [];
            
            // Ø±ÙØ¹ Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª
            defaultData.sectors.forEach(sector => {
                const sectorData = {
                    ...sector,
                    createdAt: new Date().toISOString(),
                    createdBy: currentUser?.uid || 'system'
                };
                promises.push(database.ref('sectors').push(sectorData));
            });
            
            // Ø±ÙØ¹ Ø§Ù„Ø±ØªØ¨
            defaultData.ranks.forEach(rank => {
                const rankData = {
                    ...rank,
                    createdAt: new Date().toISOString(),
                    createdBy: currentUser?.uid || 'system'
                };
                promises.push(database.ref('ranks').push(rankData));
            });
            
            // Ø±ÙØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª
            defaultData.vehicles.forEach(vehicle => {
                const vehicleData = {
                    ...vehicle,
                    createdAt: new Date().toISOString(),
                    createdBy: currentUser?.uid || 'system'
                };
                promises.push(database.ref('vehicles').push(vehicleData));
            });
            
            Promise.all(promises)
                .then(() => {
                    hideLoading();
                    showToast('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Firebase', 'success');
                    updateFirebaseStatus('connected');
                    updateLastUpdateTime();
                })
                .catch((error) => {
                    hideLoading();
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:', error);
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                    updateFirebaseStatus('error');
                });
        }

        function syncAllData() {
            showLoading('Ø¬Ø§Ø±ÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
            updateFirebaseStatus('syncing');
            
            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
            setTimeout(() => {
                hideLoading();
                showToast('âœ… ØªÙ…Øª Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                updateFirebaseStatus('connected');
                updateLastUpdateTime();
            }, 2000);
        }

        function clearFirebaseData() {
            if (!confirm('âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ FirebaseØŸ\n\nÙ‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§!')) {
                return;
            }
            
            if (!confirm('âŒ ØªØ£ÙƒÙŠØ¯ Ù†Ù‡Ø§Ø¦ÙŠ: Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª ÙˆØ§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª ÙˆØ§Ù„Ø±ØªØ¨!')) {
                return;
            }
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase...');
            
            const promises = [
                database.ref('vehicles').remove(),
                database.ref('sectors').remove(),
                database.ref('ranks').remove()
            ];
            
            Promise.all(promises)
                .then(() => {
                    hideLoading();
                    showToast('âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† Firebase', 'success');
                    updateLastUpdateTime();
                })
                .catch((error) => {
                    hideLoading();
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                });
        }

        function refreshFirebaseData() {
            showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase...');
            updateFirebaseStatus('syncing');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            loadAllData()
                .then(() => {
                    hideLoading();
                    showToast('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    updateFirebaseStatus('connected');
                })
                .catch((error) => {
                    hideLoading();
                    showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                    updateFirebaseStatus('error');
                });
        }

        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ar-EG');
            const dateString = now.toLocaleDateString('ar-EG');
            document.getElementById('last-update-time').value = `${dateString} ${timeString}`;
        }

        // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ==========
        function updateDashboardStats() {
            const adminCount = users.filter(u => u.role === 'admin').length;
            const editorCount = users.filter(u => u.role === 'editor').length;
            const viewerCount = users.filter(u => u.role === 'viewer').length;
            
            document.getElementById('admin-count').textContent = adminCount;
            document.getElementById('editor-count').textContent = editorCount;
            document.getElementById('viewer-count').textContent = viewerCount;
        }

        function updateRecentVehicles() {
            const container = document.getElementById('recent-vehicles');
            if (!container) return;
            
            const recentVehicles = vehicles.slice(-5).reverse();
            
            if (recentVehicles.length === 0) {
                container.innerHTML = '<p class="text-muted text-center py-3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±ÙƒØ¨Ø§Øª Ù…Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯</p>';
                return;
            }
            
            let html = '<div class="list-group">';
            
            recentVehicles.forEach(vehicle => {
                const sectorName = vehicle.sector || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                
                html += `
                    <div class="list-group-item list-group-item-action border-0 mb-2 rounded" 
                         style="cursor: pointer;"
                         onclick="editVehicle('${vehicle.id}')">
                        <div class="d-flex align-items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-car text-primary"></i>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="mb-1">${vehicle.type}</h6>
                                <small class="text-muted">${sectorName} - ${vehicle.code}</small>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function updateChart() {
            const ctx = document.getElementById('stats-chart');
            if (!ctx) return;
            
            if (chart) {
                chart.destroy();
            }
            
            const vehicleTypes = ["Ø§Ù„ÙÙˆØ±Ø¯ ÙÙƒØªÙˆØ±ÙŠØ§", "Ø§Ù„Ø¯ÙˆØ¯Ø¬ ØªØ´Ø§Ø±Ø¬Ø±", "ÙÙˆØ±Ø¯ Ø§ÙƒØ³Ø¨Ù„ÙˆØ±", "ØªØ§Ù‡Ùˆ"];
            const vehicleCounts = vehicleTypes.map(type => 
                vehicles.filter(v => v.type === type).length
            );
            
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: vehicleTypes,
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª',
                        data: vehicleCounts,
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.7)',
                            'rgba(231, 76, 60, 0.7)',
                            'rgba(46, 204, 113, 0.7)',
                            'rgba(155, 89, 182, 0.7)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateDropdowns() {
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª
            const sectorSelects = ['vehicle-sector', 'search-sector'];
            sectorSelects.forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    let options = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø·Ø§Ø¹</option>';
                    sectors.forEach(sector => {
                        options += `<option value="${sector.id}">${sector.name}</option>`;
                    });
                    select.innerHTML = options;
                }
            });
            
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±ØªØ¨
            const rankSelects = ['vehicle-rank', 'search-rank'];
            rankSelects.forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    let options = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø±ØªØ¨Ø©</option>';
                    ranks.forEach(rank => {
                        options += `<option value="${rank.id}">${rank.name}</option>`;
                    });
                    select.innerHTML = options;
                }
            });
        }

        function updateSectorsList() {
            const container = document.getElementById('sectors-list');
            if (!container) return;
            
            let html = '';
            
            sectors.forEach(sector => {
                html += `
                    <tr>
                        <td>${sector.name}</td>
                        <td><code>${sector.code}</code></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="editSector('${sector.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteSector('${sector.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            container.innerHTML = html;
        }

        function editSector(sectorId) {
            const sector = sectors.find(s => s.id === sectorId);
            if (!sector) return;
            
            document.getElementById('sector-id').value = sector.id;
            document.getElementById('sector-name').value = sector.name;
            document.getElementById('sector-code').value = sector.code;
            document.getElementById('sector-description').value = sector.description || '';
            
            showSection('manage-sectors');
        }

        function editVehicle(vehicleId) {
            const vehicle = vehicles.find(v => v.id === vehicleId);
            if (!vehicle) return;
            
            document.getElementById('vehicle-id').value = vehicle.id;
            document.getElementById('vehicle-type').value = vehicle.type;
            document.getElementById('vehicle-code').value = vehicle.code;
            document.getElementById('vehicle-sector').value = vehicle.sectorId || '';
            document.getElementById('vehicle-rank').value = vehicle.rankId || '';
            document.getElementById('vehicle-color1').value = vehicle.color1;
            document.getElementById('vehicle-color2').value = vehicle.color2;
            document.getElementById('vehicle-image').value = vehicle.image;
            document.getElementById('vehicle-notes').value = vehicle.notes || '';
            
            showSection('add-vehicle');
        }

        function deleteSector(sectorId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø·Ø§Ø¹ØŸ')) return;
            
            database.ref('sectors/' + sectorId).remove()
                .then(() => {
                    showToast('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                })
                .catch((error) => {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù‚Ø·Ø§Ø¹:', error);
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù‚Ø·Ø§Ø¹', 'error');
                });
        }

        // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¨Ø­Ø« ==========
        function searchVehicles() {
            const sectorId = document.getElementById('search-sector').value;
            const rankId = document.getElementById('search-rank').value;
            const type = document.getElementById('search-type').value;
            
            if (!sectorId) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            if (!rankId) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±ØªØ¨Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            // ØªØµÙÙŠØ© Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª
            let filteredVehicles = vehicles.filter(v => {
                const matchesSector = v.sector === sectorId || v.sectorId === sectorId;
                const matchesRank = v.rank === rankId || v.rankId === rankId;
                return matchesSector && matchesRank;
            });
            
            if (type) {
                filteredVehicles = filteredVehicles.filter(v => v.type === type);
            }
            
            displaySearchResults(filteredVehicles);
        }

        function displaySearchResults(vehiclesToDisplay) {
            const container = document.getElementById('search-results');
            
            if (vehiclesToDisplay.length === 0) {
                container.innerHTML = `
                    <div class="col-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body text-center py-5">
                                <i class="fas fa-car fa-4x text-muted mb-3"></i>
                                <h4 class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±ÙƒØ¨Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«</h4>
                                <p class="text-muted mt-2">Ø¬Ø±Ø¨ ØªØºÙŠÙŠØ± Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            vehiclesToDisplay.forEach(vehicle => {
                const sector = sectors.find(s => s.id === vehicle.sector || s.id === vehicle.sectorId);
                const rank = ranks.find(r => r.id === vehicle.rank || r.id === vehicle.rankId);
                const sectorName = sector ? sector.name : vehicle.sector || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const rankName = rank ? rank.name : vehicle.rank || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                
                html += `
                    <div class="col-md-4 col-sm-6 mb-4">
                        <div class="card vehicle-card h-100">
                            <div class="vehicle-img-container">
                                <img src="${vehicle.image}" 
                                     class="vehicle-img" 
                                     alt="${vehicle.type}"
                                     onerror="this.onerror=null; this.src='https://via.placeholder.com/300x200/4c4c4c/FFFFFF?text=${encodeURIComponent(vehicle.type)}'">
                                <div class="position-absolute top-0 start-0 m-2">
                                    <span class="rank-badge">${rankName}</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h5 class="card-title mb-0 text-primary">${vehicle.type}</h5>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-outline-primary" onclick="editVehicle('${vehicle.id}')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="deleteVehicle('${vehicle.id}')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <p class="card-text">
                                    <strong><i class="fas fa-building me-1"></i>Ø§Ù„Ù‚Ø·Ø§Ø¹:</strong> ${sectorName}<br>
                                    <strong><i class="fas fa-user-tie me-1"></i>Ø§Ù„Ø±ØªØ¨Ø©:</strong> ${rankName}<br>
                                    <strong><i class="fas fa-code me-1"></i>Ø§Ù„ÙƒÙˆØ¯:</strong> <code>${vehicle.code}</code><br>
                                    <strong><i class="fas fa-palette me-1"></i>Ø§Ù„Ø£Ù„ÙˆØ§Ù†:</strong>
                                    <span class="color-preview" style="background-color: #${vehicle.color1};" 
                                          title="Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£ÙˆÙ„: #${vehicle.color1}"
                                          onclick="copyToClipboard('#${vehicle.color1}')"></span>
                                    <span class="color-preview" style="background-color: #${vehicle.color2};" 
                                          title="Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ: #${vehicle.color2}"
                                          onclick="copyToClipboard('#${vehicle.color2}')"></span>
                                </p>
                                <div class="mt-3">
                                    <button class="btn btn-sm btn-outline-primary me-2" onclick="copyToClipboard('${vehicle.code}')">
                                        <i class="fas fa-copy me-1"></i>Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯
                                    </button>
                                    <button class="btn btn-sm btn-outline-info" onclick="copyToClipboard('${vehicle.image}')">
                                        <i class="fas fa-link me-1"></i>Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·
                                    </button>
                                </div>
                                ${vehicle.notes ? `
                                    <div class="alert alert-light mt-3 p-2">
                                        <small><i class="fas fa-sticky-note me-1"></i>${vehicle.notes}</small>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function deleteVehicle(vehicleId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©ØŸ')) return;
            
            database.ref('vehicles/' + vehicleId).remove()
                .then(() => {
                    showToast('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                })
                .catch((error) => {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø±ÙƒØ¨Ø©:', error);
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', 'error');
                });
        }

        // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ø§Ù…Ø© ==========
        function getRoleName(roleCode) {
            const roles = {
                'admin': 'Ù…Ø¯ÙŠØ±',
                'editor': 'Ù…Ø­Ø±Ø±',
                'viewer': 'Ù…Ø´Ø§Ù‡Ø¯'
            };
            return roles[roleCode] || roleCode;
        }

        function getAuthErrorMessage(errorCode) {
            const messages = {
                'auth/invalid-email': 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­',
                'auth/user-disabled': 'Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø·Ù„',
                'auth/user-not-found': 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
                'auth/wrong-password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©',
                'auth/email-already-in-use': 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„',
                'auth/weak-password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ©ØŒ ÙŠØ¬Ø¨ Ø£Ù† ØªØªÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„',
                'auth/operation-not-allowed': 'Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹',
                'auth/too-many-requests': 'ØªÙ… Ø±ÙØ¶ Ø§Ù„ÙˆØµÙˆÙ„ Ø¨Ø³Ø¨Ø¨ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªÙƒØ±Ø±Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹'
            };
            
            return messages[errorCode] || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
        }

        function updatePermissions(role) {
            const adminElements = ['add-vehicle-link', 'manage-sectors-link', 'manage-ranks-link', 
                                 'manage-colors-link', 'manage-users-link', 'system-tools-link'];
            
            adminElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = role === 'admin' ? 'block' : 'none';
                }
            });
        }

        function showDashboard() {
            document.getElementById('login-page').classList.add('d-none');
            document.getElementById('dashboard').classList.remove('d-none');
            showSection('dashboard-home');
        }

        function showLogin() {
            document.getElementById('login-page').classList.remove('d-none');
            document.getElementById('dashboard').classList.add('d-none');
        }

        function showSection(sectionId) {
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.add('d-none');
            });
            
            document.querySelectorAll('.sidebar a').forEach(link => {
                link.classList.remove('active');
            });
            
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('d-none');
            }
            
            const activeLink = document.querySelector(`.sidebar a[onclick*="${sectionId}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }

        function resetVehicleForm() {
            document.getElementById('vehicle-form').reset();
            document.getElementById('vehicle-id').value = '';
            document.getElementById('save-vehicle-btn').innerHTML = '<i class="fas fa-save me-2"></i>Ø­ÙØ¸ ÙÙŠ Firebase';
        }

        function resetSectorForm() {
            document.getElementById('sector-form').reset();
            document.getElementById('sector-id').value = '';
        }

        function resetSearch() {
            document.getElementById('search-sector').value = '';
            document.getElementById('search-rank').value = '';
            document.getElementById('search-type').value = '';
            
            const container = document.getElementById('search-results');
            container.innerHTML = `
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body text-center py-5">
                            <i class="fas fa-car fa-4x text-muted mb-3"></i>
                            <h4 class="text-muted">Ù‚Ù… Ø¨Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ø­Ø« Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</h4>
                            <p class="text-muted mt-2">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø·Ø§Ø¹ ÙˆØ§Ù„Ø±ØªØ¨Ø© Ø«Ù… Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¨Ø­Ø«</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©', 'success');
            }).catch(err => {
                showToast('âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©', 'error');
            });
        }

        function showLoading(message = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...') {
            let loadingDiv = document.getElementById('loading-overlay');
            
            if (!loadingDiv) {
                loadingDiv = document.createElement('div');
                loadingDiv.id = 'loading-overlay';
                loadingDiv.className = 'loading-overlay';
                loadingDiv.innerHTML = `
                    <div class="text-center">
                        <div class="spinner-border text-light" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3 text-light">${message}</p>
                    </div>
                `;
                document.body.appendChild(loadingDiv);
            } else {
                loadingDiv.style.display = 'flex';
                loadingDiv.querySelector('p').textContent = message;
            }
        }

        function hideLoading() {
            const loadingDiv = document.getElementById('loading-overlay');
            if (loadingDiv) {
                loadingDiv.style.display = 'none';
            }
        }

        function showToast(message, type = 'info') {
            const bgColor = type === 'success' ? '#28a745' : 
                            type === 'error' ? '#dc3545' : 
                            type === 'warning' ? '#ffc107' : 
                            '#17a2b8';
            
            Toastify({
                text: message,
                duration: 3000,
                close: true,
                gravity: "top",
                position: "center",
                backgroundColor: bgColor,
                stopOnFocus: true,
                className: "text-end"
            }).showToast();
        }

        function showError(message) {
            const errorElement = document.getElementById('login-error');
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.remove('d-none');
            }
        }

        function setupEventListeners() {
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†
            document.getElementById('vehicle-color1')?.addEventListener('input', function() {
                const preview = document.getElementById('color1-preview');
                if (preview && this.value) {
                    preview.style.backgroundColor = '#' + this.value.replace('#', '');
                }
            });
            
            document.getElementById('vehicle-color2')?.addEventListener('input', function() {
                const preview = document.getElementById('color2-preview');
                if (preview && this.value) {
                    preview.style.backgroundColor = '#' + this.value.replace('#', '');
                }
            });
        }

        // Ø¯ÙˆØ§Ù„ Ø¥Ø¶Ø§ÙÙŠØ© (Ù„Ù„ØªØ·ÙˆÙŠØ±)
        function openColorPicker(fieldId) {
            showToast('Ù…ÙŠØ²Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
        }

        function previewImage() {
            const imageUrl = document.getElementById('vehicle-image').value;
            if (!imageUrl) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            window.open(imageUrl, '_blank');
        }

        // Ø¨Ø¯Ø§ÙŠØ© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…
        console.log('ğŸš€ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù„Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„Ø´Ø±Ø·ÙŠØ© - ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­');
        console.log('ğŸ”¥ Firebase Ù…Ù‡ÙŠØ£ ÙˆØ¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
        console.log('ğŸ“§ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…: admin@test.com / 123456');
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام البحث المتقدم للمركبات الشرطية</title>
    
    <!-- روابط CDN الخارجية -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --admin-color: #e74c3c;
            --editor-color: #f39c12;
            --viewer-color: #27ae60;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            margin: 0;
            padding: 0;
        }
        
        .sidebar {
            height: 100vh;
            position: fixed;
            right: 0;
            top: 0;
            background-color: var(--primary-color);
            color: white;
            padding-top: 20px;
            width: 250px;
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .main-content {
            margin-right: 250px;
            padding: 20px;
            transition: all 0.3s;
            min-height: 100vh;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                margin-right: -250px;
            }
            
            .sidebar.active {
                margin-right: 0;
            }
            
            .main-content {
                margin-right: 0;
            }
        }
        
        .sidebar a {
            color: white;
            text-decoration: none;
            display: block;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }
        
        .sidebar a:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        .sidebar a.active {
            background-color: var(--secondary-color);
        }
        
        .user-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        
        .badge-admin {
            background-color: var(--admin-color);
        }
        
        .badge-editor {
            background-color: var(--editor-color);
        }
        
        .badge-viewer {
            background-color: var(--viewer-color);
        }
        
        .vehicle-card {
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s;
            height: 100%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .vehicle-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .vehicle-img-container {
            height: 200px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f5f5f5;
        }
        
        .vehicle-img {
            max-height: 100%;
            max-width: 100%;
            object-fit: cover;
        }
        
        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-block;
            margin: 0 5px;
            border: 1px solid #ddd;
        }
        
        .login-container {
            max-width: 500px;
            margin: 100px auto;
            padding: 30px;
            border-radius: 10px;
            background-color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .logo {
            font-weight: bold;
            font-size: 24px;
            color: var(--primary-color);
            text-align: center;
        }
        
        .logo span {
            color: var(--secondary-color);
        }
        
        .section-title {
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
            margin-bottom: 30px;
            color: var(--primary-color);
        }
        
        .toggle-sidebar {
            display: none;
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 1001;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 15px;
        }
        
        @media (max-width: 768px) {
            .toggle-sidebar {
                display: block;
            }
        }
        
        .dashboard-card {
            border-radius: 10px;
            padding: 20px;
            color: white;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .dashboard-card i {
            font-size: 40px;
            margin-bottom: 15px;
        }
        
        .card-admin {
            background-color: var(--admin-color);
        }
        
        .card-editor {
            background-color: var(--editor-color);
        }
        
        .card-viewer {
            background-color: var(--viewer-color);
        }
        
        .card-vehicles {
            background-color: #9b59b6;
        }
        
        .copy-btn {
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .copy-btn:hover {
            transform: scale(1.1);
        }
        
        .rank-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            background-color: #e3f2fd;
            color: #1976d2;
            margin: 2px;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
            justify-content: flex-end;
        }
        
        .action-buttons button {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            font-size: 20px;
        }
        
        .color-option {
            cursor: pointer;
            display: inline-block;
            margin: 5px;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <!-- تسجيل الدخول -->
    <div id="login-page" class="login-container">
        <div class="text-center mb-4">
            <h1 class="logo">نظام <span>البحث</span> المتقدم</h1>
            <p class="text-muted">إدارة وتصفح المركبات الشرطية</p>
        </div>
        
        <div class="mb-3">
            <label for="login-email" class="form-label">البريد الإلكتروني</label>
            <input type="email" class="form-control" id="login-email" placeholder="أدخل بريدك الإلكتروني" value="admin@vehicles.com">
        </div>
        
        <div class="mb-3">
            <label for="login-password" class="form-label">كلمة المرور</label>
            <input type="password" class="form-control" id="login-password" placeholder="أدخل كلمة المرور" value="Admin123">
        </div>
        
        <div class="d-grid gap-2">
            <button class="btn btn-primary" onclick="login()">تسجيل الدخول</button>
        </div>
        
        <div id="login-error" class="alert alert-danger mt-3 d-none"></div>
        
        <div class="mt-3 text-center">
            <small class="text-muted">بيانات الدخول الافتراضية معبأة</small>
        </div>
    </div>

    <!-- لوحة التحكم الرئيسية -->
    <div id="dashboard" class="d-none">
        <!-- شريط التنقل الجانبي -->
        <button class="toggle-sidebar" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        
        <div class="sidebar" id="sidebar">
            <div class="text-center mb-4">
                <h2 class="logo">نظام <span>البحث</span></h2>
                <p class="text-muted small" id="user-info">مرحباً، </p>
                <span class="user-badge" id="user-role-badge">مدير</span>
            </div>
            
            <a href="#" class="active" onclick="showSection('dashboard-home')">
                <i class="fas fa-home me-2"></i> لوحة التحكم
            </a>
            
            <a href="#" onclick="showSection('search-vehicles')">
                <i class="fas fa-search me-2"></i> بحث المركبات
            </a>
            
            <a href="#" onclick="showSection('add-vehicle')" id="add-vehicle-link">
                <i class="fas fa-car me-2"></i> إضافة مركبة
            </a>
            
            <a href="#" onclick="showSection('manage-sectors')" id="manage-sectors-link">
                <i class="fas fa-list me-2"></i> إدارة القطاعات
            </a>
            
            <a href="#" onclick="showSection('manage-ranks')" id="manage-ranks-link">
                <i class="fas fa-user-tie me-2"></i> إدارة الرتب
            </a>
            
            <a href="#" onclick="showSection('manage-colors')" id="manage-colors-link">
                <i class="fas fa-palette me-2"></i> إدارة الألوان
            </a>
            
            <a href="#" onclick="showSection('manage-users')" id="manage-users-link">
                <i class="fas fa-users me-2"></i> إدارة المستخدمين
            </a>
            
            <a href="#" onclick="showSection('add-user')" id="add-user-link">
                <i class="fas fa-user-plus me-2"></i> إضافة مستخدم
            </a>
            
            <a href="#" onclick="logout()" class="mt-5">
                <i class="fas fa-sign-out-alt me-2"></i> تسجيل الخروج
            </a>
        </div>
        
        <!-- المحتوى الرئيسي -->
        <div class="main-content" id="main-content">
            <!-- لوحة التحكم الرئيسية -->
            <div id="dashboard-home" class="dashboard-section">
                <h2 class="section-title">لوحة التحكم</h2>
                
                <div class="row">
                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-admin">
                            <i class="fas fa-user-shield"></i>
                            <h4>المديرون</h4>
                            <h2 id="admin-count">0</h2>
                        </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-editor">
                            <i class="fas fa-edit"></i>
                            <h4>المحررون</h4>
                            <h2 id="editor-count">0</h2>
                        </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-viewer">
                            <i class="fas fa-eye"></i>
                            <h4>المشاهدون</h4>
                            <h2 id="viewer-count">0</h2>
                        </div>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-vehicles">
                            <i class="fas fa-car"></i>
                            <h4>المركبات</h4>
                            <h2 id="vehicle-count">0</h2>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">آخر المركبات المضافة</h5>
                                <div id="recent-vehicles" class="mt-3">
                                    <p class="text-muted">جاري التحميل...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">إحصائيات النظام</h5>
                                <canvas id="stats-chart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- قسم البحث -->
            <div id="search-vehicles" class="dashboard-section d-none">
                <h2 class="section-title">بحث المركبات</h2>
                
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">القطاع *</label>
                                <select class="form-control" id="search-sector" required>
                                    <option value="">اختر القطاع</option>
                                </select>
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label class="form-label">الرتبة *</label>
                                <select class="form-control" id="search-rank" required>
                                    <option value="">اختر الرتبة</option>
                                </select>
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label class="form-label">نوع المركبة</label>
                                <select class="form-control" id="search-type" disabled>
                                    <option value="">جميع الأنواع</option>
                                    <option value="الفورد فكتوريا">الفورد فكتوريا</option>
                                    <option value="الدودج تشارجر">الدودج تشارجر</option>
                                    <option value="فورد اكسبلور">فورد اكسبلور</option>
                                    <option value="تاهو">تاهو</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button class="btn btn-primary" onclick="searchVehicles()">
                                <i class="fas fa-search me-2"></i>بحث
                            </button>
                            <button class="btn btn-outline-secondary" onclick="resetSearch()">
                                <i class="fas fa-redo me-2"></i>إعادة تعيين
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="row" id="search-results">
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-car fa-3x text-muted mb-3"></i>
                        <h4 class="text-muted">قم بإجراء بحث لعرض المركبات</h4>
                    </div>
                </div>
            </div>
            
            <!-- إضافة مركبة جديدة -->
            <div id="add-vehicle" class="dashboard-section d-none">
                <h2 class="section-title" id="vehicle-form-title">إضافة مركبة جديدة</h2>
                
                <div class="card">
                    <div class="card-body">
                        <form id="add-vehicle-form">
                            <input type="hidden" id="edit-vehicle-id">
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">نوع المركبة *</label>
                                    <select class="form-control" id="vehicle-type" required>
                                        <option value="">اختر نوع المركبة</option>
                                        <option value="الفورد فكتوريا">الفورد فكتوريا</option>
                                        <option value="الدودج تشارجر">الدودج تشارجر</option>
                                        <option value="فورد اكسبلور">فورد اكسبلور</option>
                                        <option value="تاهو">تاهو</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">الكود الفني *</label>
                                    <input type="text" class="form-control" id="vehicle-code" required>
                                    <small class="text-muted">مثال: cvpi_sign_1 أو alphatexture</small>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">القطاع *</label>
                                    <select class="form-control" id="vehicle-sector" required>
                                        <option value="">اختر القطاع</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">الرتبة *</label>
                                    <select class="form-control" id="vehicle-rank" required>
                                        <option value="">اختر الرتبة</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">اللون الأول *</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="primary-color" placeholder="مثال: 4c4c4c" required>
                                        <span class="input-group-text color-preview" id="primary-color-preview"></span>
                                        <button type="button" class="btn btn-outline-secondary" onclick="openColorPicker('primary-color')">
                                            <i class="fas fa-eye-dropper"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">اللون الثانوي *</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="secondary-color" placeholder="مثال: FFFFFF" required>
                                        <span class="input-group-text color-preview" id="secondary-color-preview"></span>
                                        <button type="button" class="btn btn-outline-secondary" onclick="openColorPicker('secondary-color')">
                                            <i class="fas fa-eye-dropper"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <label class="form-label">رابط الصورة *</label>
                                    <input type="url" class="form-control" id="vehicle-image" required>
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">معاينة الصورة</label>
                                    <button type="button" class="btn btn-outline-info w-100" onclick="previewImage()">
                                        <i class="fas fa-image"></i> معاينة
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">ملاحظات إضافية</label>
                                <textarea class="form-control" id="vehicle-notes" rows="3"></textarea>
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="submit" class="btn btn-primary" id="save-vehicle-btn">
                                    <i class="fas fa-save me-2"></i>حفظ المركبة
                                </button>
                                <button type="button" class="btn btn-outline-secondary" onclick="resetVehicleForm()">
                                    <i class="fas fa-times me-2"></i>إلغاء
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- إدارة القطاعات -->
            <div id="manage-sectors" class="dashboard-section d-none">
                <h2 class="section-title">إدارة القطاعات</h2>
                
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">إضافة / تعديل قطاع</h5>
                        <form id="sector-form">
                            <input type="hidden" id="edit-sector-id">
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">اسم القطاع *</label>
                                    <input type="text" class="form-control" id="sector-name" required>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">رمز القطاع *</label>
                                    <input type="text" class="form-control" id="sector-code" required>
                                    <small class="text-muted">يستخدم في البحث والتصفية</small>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">الوصف</label>
                                <textarea class="form-control" id="sector-description" rows="2"></textarea>
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="submit" class="btn btn-primary" id="save-sector-btn">
                                    <i class="fas fa-save me-2"></i>حفظ القطاع
                                </button>
                                <button type="button" class="btn btn-outline-secondary" onclick="resetSectorForm()">
                                    <i class="fas fa-times me-2"></i>إلغاء
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">القطاعات الحالية</h5>
                        <div class="table-responsive">
                            <table class="table table-hover" id="sectors-table">
                                <thead>
                                    <tr>
                                        <th>اسم القطاع</th>
                                        <th>الرمز</th>
                                        <th>عدد المركبات</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="4" class="text-center">جاري التحميل...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- إدارة الرتب -->
            <div id="manage-ranks" class="dashboard-section d-none">
                <h2 class="section-title">إدارة الرتب العسكرية</h2>
                
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">إضافة / تعديل رتبة</h5>
                        <form id="rank-form">
                            <input type="hidden" id="edit-rank-id">
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">اسم الرتبة *</label>
                                    <input type="text" class="form-control" id="rank-name" required>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">رمز الرتبة *</label>
                                    <input type="text" class="form-control" id="rank-code" required>
                                    <small class="text-muted">يستخدم في البحث والتصفية</small>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">الوصف</label>
                                <textarea class="form-control" id="rank-description" rows="2"></textarea>
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="submit" class="btn btn-primary" id="save-rank-btn">
                                    <i class="fas fa-save me-2"></i>حفظ الرتبة
                                </button>
                                <button type="button" class="btn btn-outline-secondary" onclick="resetRankForm()">
                                    <i class="fas fa-times me-2"></i>إلغاء
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">الرتب الحالية</h5>
                        <div class="table-responsive">
                            <table class="table table-hover" id="ranks-table">
                                <thead>
                                    <tr>
                                        <th>اسم الرتبة</th>
                                        <th>الرمز</th>
                                        <th>عدد المركبات</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="4" class="text-center">جاري التحميل...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- إدارة الألوان -->
            <div id="manage-colors" class="dashboard-section d-none">
                <h2 class="section-title">إدارة الألوان</h2>
                
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">إضافة / تعديل لون</h5>
                        <form id="color-form">
                            <input type="hidden" id="edit-color-id">
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">كود اللون *</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="color-code" placeholder="مثال: 4c4c4c" required>
                                        <span class="input-group-text color-preview" id="color-code-preview"></span>
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">اسم اللون *</label>
                                    <input type="text" class="form-control" id="color-name" required>
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="submit" class="btn btn-primary" id="save-color-btn">
                                    <i class="fas fa-save me-2"></i>حفظ اللون
                                </button>
                                <button type="button" class="btn btn-outline-secondary" onclick="resetColorForm()">
                                    <i class="fas fa-times me-2"></i>إلغاء
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">الألوان المستخدمة في النظام</h5>
                        <div id="colors-list" class="row">
                            <div class="col-12 text-center">
                                <p class="text-muted">جاري التحميل...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- إدارة المستخدمين -->
            <div id="manage-users" class="dashboard-section d-none">
                <h2 class="section-title">إدارة المستخدمين</h2>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover" id="users-table">
                                <thead>
                                    <tr>
                                        <th>الاسم</th>
                                        <th>البريد الإلكتروني</th>
                                        <th>الدور</th>
                                        <th>تاريخ التسجيل</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="5" class="text-center">جاري التحميل...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- إضافة مستخدم جديد -->
            <div id="add-user" class="dashboard-section d-none">
                <h2 class="section-title">إضافة مستخدم جديد</h2>
                
                <div class="card">
                    <div class="card-body">
                        <form id="add-user-form">
                            <div class="mb-3">
                                <label for="user-name" class="form-label">الاسم الكامل *</label>
                                <input type="text" class="form-control" id="user-name" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="user-email" class="form-label">البريد الإلكتروني *</label>
                                <input type="email" class="form-control" id="user-email" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="user-password" class="form-label">كلمة المرور *</label>
                                <input type="password" class="form-control" id="user-password" required>
                                <small class="text-muted">يجب أن تتكون من 6 أحرف على الأقل</small>
                            </div>
                            
                            <div class="mb-3">
                                <label for="user-role" class="form-label">دور المستخدم *</label>
                                <select class="form-control" id="user-role" required>
                                    <option value="">اختر الدور</option>
                                    <option value="viewer">مشاهد</option>
                                    <option value="editor">محرر</option>
                                    <option value="admin">مدير</option>
                                </select>
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-user-plus me-2"></i>إضافة المستخدم
                                </button>
                                <button type="reset" class="btn btn-outline-secondary">
                                    <i class="fas fa-times me-2"></i>إلغاء
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نافذة اختيار الألوان -->
    <div class="modal fade" id="colorPickerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">اختيار اللون</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="color" id="color-picker" class="w-100 mb-3" style="height: 50px;">
                    <div class="input-group">
                        <input type="text" class="form-control" id="color-hex" placeholder="أدخل كود اللون">
                        <button class="btn btn-primary" onclick="applyColor()">تطبيق</button>
                    </div>
                    <div class="mt-3">
                        <h6>الألوان الشائعة:</h6>
                        <div class="d-flex flex-wrap gap-2 mt-2" id="common-colors">
                            <!-- سيتم ملؤها بالبيانات -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- معاينة الصورة -->
    <div class="modal fade" id="imagePreviewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">معاينة الصورة</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="preview-image" src="" class="img-fluid" alt="معاينة الصورة" style="max-height: 500px;">
                    <div class="mt-3">
                        <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard(document.getElementById('vehicle-image').value)">
                            <i class="fas fa-copy me-1"></i>نسخ الرابط
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- مكتبات JavaScript -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <!-- التطبيق الرئيسي -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCg3Dmf_Odgfm2IL1IZXr_Kl16IaqiWqso",
            authDomain: "verg-micanic.firebaseapp.com",
            databaseURL: "https://verg-micanic-default-rtdb.firebaseio.com",
            projectId: "verg-micanic",
            storageBucket: "verg-micanic.firebasestorage.app",
            messagingSenderId: "881689454596",
            appId: "1:881689454596:web:e630ad9f555ba8feabed51",
            measurementId: "G-B9JZ3CR9GS"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        // بيانات التطبيق
        let currentUser = null;
        let userRole = null;
        let sectors = [];
        let ranks = [];
        let vehicles = [];
        let users = [];
        let colors = [];
        let selectedColorField = '';
        let vehiclesChart = null;

        // دالة رئيسية لتشغيل التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            console.log('التطبيق جاهز للعمل...');
            
            // التحقق من حالة تسجيل الدخول
            auth.onAuthStateChanged(function(user) {
                if (user) {
                    console.log('المستخدم مسجل:', user.email);
                    currentUser = user;
                    loadUserData();
                } else {
                    console.log('لا يوجد مستخدم مسجل');
                    showLogin();
                }
            });
            
            // استعداد النماذج
            setupForms();
        });

        // ========== دوال المصادقة ==========
        function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorElement = document.getElementById('login-error');
            
            if (!email || !password) {
                showError(errorElement, 'يرجى إدخال البريد الإلكتروني وكلمة المرور');
                return;
            }
            
            showLoading('جاري تسجيل الدخول...');
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    hideLoading();
                    showToast('تم تسجيل الدخول بنجاح!', 'success');
                })
                .catch((error) => {
                    hideLoading();
                    showError(errorElement, getAuthErrorMessage(error.code));
                });
        }

        function logout() {
            auth.signOut().then(() => {
                currentUser = null;
                userRole = null;
                showLogin();
                showToast('تم تسجيل الخروج بنجاح', 'info');
            });
        }

        // ========== دوال إدارة البيانات ==========
        function loadUserData() {
            const userRef = database.ref('users/' + currentUser.uid);
            
            userRef.once('value').then((snapshot) => {
                const userData = snapshot.val();
                if (userData) {
                    userRole = userData.role;
                    
                    // تحديث واجهة المستخدم
                    document.getElementById('user-info').textContent = `مرحباً، ${userData.name}`;
                    document.getElementById('user-role-badge').textContent = getRoleName(userData.role);
                    document.getElementById('user-role-badge').className = `user-badge badge-${userData.role}`;
                    
                    // التحكم في الصلاحيات
                    updatePermissions(userData.role);
                    
                    // إظهار لوحة التحكم
                    showDashboard();
                    
                    // تحميل البيانات
                    loadAllData();
                    
                    // إنشاء مدير افتراضي إذا لم يكن موجوداً
                    createDefaultAdminIfNeeded();
                } else {
                    // إذا لم توجد بيانات المستخدم، أنشئها
                    createUserData();
                }
            }).catch(error => {
                console.error('خطأ في تحميل بيانات المستخدم:', error);
            });
        }

        function createUserData() {
            const userData = {
                name: "المدير الرئيسي",
                email: currentUser.email,
                role: "admin",
                createdAt: new Date().toISOString(),
                createdBy: currentUser.uid
            };
            
            database.ref('users/' + currentUser.uid).set(userData)
                .then(() => {
                    loadUserData();
                });
        }

        function createDefaultAdminIfNeeded() {
            database.ref('users').once('value').then((snapshot) => {
                if (!snapshot.exists()) {
                    // إنشاء حساب مدير افتراضي
                    const adminEmail = "admin@vehicles.com";
                    const adminPassword = "Admin123";
                    
                    auth.createUserWithEmailAndPassword(adminEmail, adminPassword)
                        .then((userCredential) => {
                            const user = userCredential.user;
                            const userData = {
                                name: "المدير الرئيسي",
                                email: adminEmail,
                                role: "admin",
                                createdAt: new Date().toISOString(),
                                createdBy: "system"
                            };
                            
                            return database.ref('users/' + user.uid).set(userData);
                        })
                        .then(() => {
                            console.log("تم إنشاء المدير الافتراضي");
                        })
                        .catch((error) => {
                            console.log("المدير الافتراضي موجود بالفعل أو حدث خطأ:", error.message);
                        });
                }
            });
        }

        function loadAllData() {
            showLoading('جاري تحميل البيانات...');
            
            Promise.all([
                loadSectors(),
                loadRanks(),
                loadVehicles(),
                loadUsers(),
                loadColors()
            ]).then(() => {
                hideLoading();
                updateDashboardStats();
            }).catch(error => {
                hideLoading();
                console.error('خطأ في تحميل البيانات:', error);
                showToast('حدث خطأ في تحميل البيانات', 'error');
            });
        }

        function loadSectors() {
            return database.ref('sectors').once('value').then((snapshot) => {
                sectors = [];
                snapshot.forEach((childSnapshot) => {
                    sectors.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                
                updateSectorDropdowns();
                updateSectorsTable();
            });
        }

        function loadRanks() {
            return database.ref('ranks').once('value').then((snapshot) => {
                ranks = [];
                snapshot.forEach((childSnapshot) => {
                    ranks.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                
                updateRankDropdowns();
                updateRanksTable();
            });
        }

        function loadVehicles() {
            return database.ref('vehicles').once('value').then((snapshot) => {
                vehicles = [];
                snapshot.forEach((childSnapshot) => {
                    vehicles.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                
                updateRecentVehicles();
                displayVehicles(vehicles);
            });
        }

        function loadUsers() {
            return database.ref('users').once('value').then((snapshot) => {
                users = [];
                snapshot.forEach((childSnapshot) => {
                    users.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                
                updateUsersTable();
            });
        }

        function loadColors() {
            return database.ref('colors').once('value').then((snapshot) => {
                colors = [];
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        colors.push({
                            id: childSnapshot.key,
                            ...childSnapshot.val()
                        });
                    });
                }
                
                updateColorsList();
                updateCommonColors();
            });
        }

        // ========== دوال العرض ==========
        function showLogin() {
            document.getElementById('login-page').classList.remove('d-none');
            document.getElementById('dashboard').classList.add('d-none');
        }

        function showDashboard() {
            document.getElementById('login-page').classList.add('d-none');
            document.getElementById('dashboard').classList.remove('d-none');
            showSection('dashboard-home');
        }

        function showSection(sectionId) {
            // إخفاء جميع الأقسام
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.add('d-none');
            });
            
            // إزالة النشط من جميع عناصر القائمة
            document.querySelectorAll('.sidebar a').forEach(link => {
                link.classList.remove('active');
            });
            
            // إظهار القسم المطلوب
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('d-none');
            }
            
            // إضافة النشط إلى العنصر المناسب في القائمة الجانبية
            const sectionName = getSectionName(sectionId);
            const activeLink = Array.from(document.querySelectorAll('.sidebar a')).find(link => 
                link.textContent.includes(sectionName)
            );
            
            if (activeLink) {
                activeLink.classList.add('active');
            }
        }

        function getSectionName(sectionId) {
            const sections = {
                'dashboard-home': 'لوحة التحكم',
                'search-vehicles': 'بحث المركبات',
                'add-vehicle': 'إضافة مركبة',
                'manage-sectors': 'إدارة القطاعات',
                'manage-ranks': 'إدارة الرتب',
                'manage-colors': 'إدارة الألوان',
                'manage-users': 'إدارة المستخدمين',
                'add-user': 'إضافة مستخدم'
            };
            return sections[sectionId] || '';
        }

        // ========== دوال مساعدة ==========
        function setupForms() {
            // نموذج إضافة المركبة
            const addVehicleForm = document.getElementById('add-vehicle-form');
            if (addVehicleForm) {
                addVehicleForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    addVehicle();
                });
            }
            
            // نموذج إضافة القطاع
            const sectorForm = document.getElementById('sector-form');
            if (sectorForm) {
                sectorForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveSector();
                });
            }
            
            // نموذج إضافة الرتبة
            const rankForm = document.getElementById('rank-form');
            if (rankForm) {
                rankForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveRank();
                });
            }
            
            // نموذج إضافة اللون
            const colorForm = document.getElementById('color-form');
            if (colorForm) {
                colorForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveColor();
                });
            }
            
            // نموذج إضافة المستخدم
            const addUserForm = document.getElementById('add-user-form');
            if (addUserForm) {
                addUserForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    addNewUser();
                });
            }
            
            // تحديث معاينة الألوان
            const primaryColor = document.getElementById('primary-color');
            if (primaryColor) {
                primaryColor.addEventListener('input', function() {
                    updateColorPreview('primary-color-preview', this.value);
                });
            }
            
            const secondaryColor = document.getElementById('secondary-color');
            if (secondaryColor) {
                secondaryColor.addEventListener('input', function() {
                    updateColorPreview('secondary-color-preview', this.value);
                });
            }
            
            const colorCode = document.getElementById('color-code');
            if (colorCode) {
                colorCode.addEventListener('input', function() {
                    updateColorPreview('color-code-preview', this.value);
                });
            }
        }

        function getRoleName(roleCode) {
            const roles = {
                'admin': 'مدير',
                'editor': 'محرر',
                'viewer': 'مشاهد'
            };
            return roles[roleCode] || roleCode;
        }

        function updatePermissions(role) {
            const adminOnly = ['add-vehicle-link', 'manage-sectors-link', 'manage-ranks-link', 
                               'manage-colors-link', 'manage-users-link', 'add-user-link'];
            
            adminOnly.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = role === 'admin' ? 'block' : 'none';
                }
            });
        }

        function getAuthErrorMessage(errorCode) {
            const messages = {
                'auth/invalid-email': 'البريد الإلكتروني غير صالح',
                'auth/user-disabled': 'هذا الحساب معطل',
                'auth/user-not-found': 'لا يوجد حساب بهذا البريد الإلكتروني',
                'auth/wrong-password': 'كلمة المرور غير صحيحة',
                'auth/email-already-in-use': 'البريد الإلكتروني مستخدم بالفعل',
                'auth/weak-password': 'كلمة المرور ضعيفة، يجب أن تتكون من 6 أحرف على الأقل',
                'auth/operation-not-allowed': 'عملية التسجيل غير مسموحة حالياً',
                'auth/too-many-requests': 'تم رفض الوصول بسبب محاولات متكررة، يرجى المحاولة لاحقاً'
            };
            
            return messages[errorCode] || 'حدث خطأ غير معروف، يرجى المحاولة مرة أخرى';
        }

        function showError(element, message) {
            if (element) {
                element.textContent = message;
                element.classList.remove('d-none');
            }
        }

        function hideError(element) {
            if (element) {
                element.classList.add('d-none');
            }
        }

        function showToast(message, type = 'info') {
            const bgColor = type === 'success' ? '#28a745' : 
                            type === 'error' ? '#dc3545' : 
                            type === 'warning' ? '#ffc107' : 
                            '#17a2b8';
            
            Toastify({
                text: message,
                duration: 3000,
                close: true,
                gravity: "top",
                position: "center",
                backgroundColor: bgColor,
                stopOnFocus: true,
                className: "text-end"
            }).showToast();
        }

        function showLoading(message = 'جاري التحميل...') {
            let loadingDiv = document.getElementById('loading-overlay');
            
            if (!loadingDiv) {
                loadingDiv = document.createElement('div');
                loadingDiv.id = 'loading-overlay';
                loadingDiv.className = 'loading-overlay';
                loadingDiv.innerHTML = `
                    <div class="text-center">
                        <div class="spinner-border" style="width: 3rem; height: 3rem;" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">${message}</p>
                    </div>
                `;
                document.body.appendChild(loadingDiv);
            } else {
                loadingDiv.style.display = 'flex';
                loadingDiv.querySelector('p').textContent = message;
            }
        }

        function hideLoading() {
            const loadingDiv = document.getElementById('loading-overlay');
            if (loadingDiv) {
                loadingDiv.style.display = 'none';
            }
        }

        // ========== دوال العرض والبحث ==========
        function updateSectorDropdowns() {
            const searchSector = document.getElementById('search-sector');
            const vehicleSector = document.getElementById('vehicle-sector');
            
            if (searchSector) {
                let options = '<option value="">اختر القطاع</option>';
                sectors.forEach(sector => {
                    options += `<option value="${sector.id}">${sector.name}</option>`;
                });
                searchSector.innerHTML = options;
            }
            
            if (vehicleSector) {
                let options = '<option value="">اختر القطاع</option>';
                sectors.forEach(sector => {
                    options += `<option value="${sector.id}">${sector.name}</option>`;
                });
                vehicleSector.innerHTML = options;
            }
        }

        function updateRankDropdowns() {
            const searchRank = document.getElementById('search-rank');
            const vehicleRank = document.getElementById('vehicle-rank');
            
            if (searchRank) {
                let options = '<option value="">اختر الرتبة</option>';
                ranks.forEach(rank => {
                    options += `<option value="${rank.id}">${rank.name}</option>`;
                });
                searchRank.innerHTML = options;
            }
            
            if (vehicleRank) {
                let options = '<option value="">اختر الرتبة</option>';
                ranks.forEach(rank => {
                    options += `<option value="${rank.id}">${rank.name}</option>`;
                });
                vehicleRank.innerHTML = options;
            }
        }

        function searchVehicles() {
            const sector = document.getElementById('search-sector').value;
            const rank = document.getElementById('search-rank').value;
            const type = document.getElementById('search-type').value;
            
            if (!sector) {
                showToast('يرجى اختيار القطاع', 'error');
                return;
            }
            
            if (!rank) {
                showToast('يرجى اختيار الرتبة', 'error');
                return;
            }
            
            let filteredVehicles = vehicles.filter(v => 
                v.sector === sector && 
                v.rank === rank
            );
            
            if (type) {
                filteredVehicles = filteredVehicles.filter(v => v.type === type);
            }
            
            displayVehicles(filteredVehicles);
        }

        function resetSearch() {
            document.getElementById('search-sector').value = '';
            document.getElementById('search-rank').value = '';
            document.getElementById('search-type').value = '';
            document.getElementById('search-type').disabled = true;
            displayVehicles(vehicles);
        }

        function displayVehicles(vehiclesToDisplay) {
            const container = document.getElementById('search-results');
            if (!container) return;
            
            if (vehiclesToDisplay.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-car fa-3x text-muted mb-3"></i>
                        <h4 class="text-muted">لا توجد مركبات مطابقة للبحث</h4>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            vehiclesToDisplay.forEach(vehicle => {
                const sectorName = getSectorName(vehicle.sector);
                const rankName = getRankName(vehicle.rank);
                
                html += `
                    <div class="col-md-4 col-sm-6 mb-4">
                        <div class="card vehicle-card h-100">
                            <div class="vehicle-img-container">
                                <img src="${vehicle.image}" class="vehicle-img" alt="${vehicle.type}" onerror="this.src='https://via.placeholder.com/300x200?text=صورة+غير+متوفرة'">
                                <div class="position-absolute top-0 start-0 m-2">
                                    <span class="rank-badge">${rankName}</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h5 class="card-title mb-0">${vehicle.type}</h5>
                                    <div class="action-buttons">
                                        ${userRole !== 'viewer' ? `
                                            <button class="btn btn-sm btn-outline-primary" onclick="editVehicle('${vehicle.id}')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger" onclick="deleteVehicle('${vehicle.id}')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                                <p class="card-text">
                                    <strong>القطاع:</strong> ${sectorName}<br>
                                    <strong>الكود:</strong> ${vehicle.code}<br>
                                    <strong>الألوان:</strong>
                                    <span class="color-preview" style="background-color: #${vehicle.primaryColor};" title="اللون الأول: #${vehicle.primaryColor}"></span>
                                    <span class="color-preview" style="background-color: #${vehicle.secondaryColor};" title="اللون الثانوي: #${vehicle.secondaryColor}"></span>
                                    <button class="btn btn-sm btn-link p-0 copy-btn" onclick="copyColors('${vehicle.primaryColor}', '${vehicle.secondaryColor}')" title="نسخ الألوان">
                                        <i class="fas fa-copy text-muted"></i>
                                    </button>
                                </p>
                                <div class="d-flex justify-content-between align-items-center mt-3">
                                    <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('${vehicle.code}')">
                                        <i class="fas fa-copy me-1"></i>نسخ الكود
                                    </button>
                                    <button class="btn btn-sm btn-outline-info" onclick="copyToClipboard('${vehicle.image}')">
                                        <i class="fas fa-copy me-1"></i>نسخ الرابط
                                    </button>
                                </div>
                                ${vehicle.notes ? `<p class="card-text mt-2"><small>${vehicle.notes}</small></p>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function copyColors(primary, secondary) {
            const text = `اللون الأول: #${primary}\nاللون الثانوي: #${secondary}`;
            copyToClipboard(text);
            showToast('تم نسخ الألوان', 'success');
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('تم النسخ إلى الحافظة', 'success');
            }).catch(err => {
                console.error('فشل النسخ:', err);
                showToast('فشل النسخ إلى الحافظة', 'error');
            });
        }

        // ========== دوال الإدارة ==========
        // سيتم إضافة باقي الدوال هنا...
        // لكن للتبسيط، سأضيف فقط الأساسيات للعمل

        function updateDashboardStats() {
            const adminCount = users.filter(u => u.role === 'admin').length;
            const editorCount = users.filter(u => u.role === 'editor').length;
            const viewerCount = users.filter(u => u.role === 'viewer').length;
            
            document.getElementById('admin-count').textContent = adminCount;
            document.getElementById('editor-count').textContent = editorCount;
            document.getElementById('viewer-count').textContent = viewerCount;
            document.getElementById('vehicle-count').textContent = vehicles.length;
            
            updateChart();
        }

        function updateRecentVehicles() {
            const container = document.getElementById('recent-vehicles');
            if (!container) return;
            
            const recentVehicles = vehicles.slice(-5).reverse();
            
            if (recentVehicles.length === 0) {
                container.innerHTML = '<p class="text-muted">لا توجد مركبات مضافة بعد</p>';
                return;
            }
            
            let html = '<div class="list-group">';
            
            recentVehicles.forEach(vehicle => {
                const sectorName = getSectorName(vehicle.sector);
                html += `
                    <a href="#" class="list-group-item list-group-item-action" onclick="showSection('search-vehicles')">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">${vehicle.type}</h6>
                            <small>${formatDate(vehicle.createdAt)}</small>
                        </div>
                        <p class="mb-1">${sectorName} - ${vehicle.code}</p>
                    </a>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function getSectorName(sectorId) {
            const sector = sectors.find(s => s.id === sectorId);
            return sector ? sector.name : 'غير معروف';
        }

        function getRankName(rankId) {
            const rank = ranks.find(r => r.id === rankId);
            return rank ? rank.name : 'غير معروف';
        }

        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('ar-EG');
            } catch (e) {
                return 'غير معروف';
            }
        }

        function updateColorPreview(elementId, colorValue) {
            const element = document.getElementById(elementId);
            if (element && colorValue) {
                element.style.backgroundColor = '#' + colorValue;
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }

        // دالة أساسية للرسم البياني (للتوسع لاحقاً)
        function updateChart() {
            const ctx = document.getElementById('stats-chart');
            if (!ctx) return;
            
            if (vehiclesChart) {
                vehiclesChart.destroy();
            }
            
            const vehicleTypes = ["الفورد فكتوريا", "الدودج تشارجر", "فورد اكسبلور", "تاهو"];
            const vehicleCounts = vehicleTypes.map(type => 
                vehicles.filter(v => v.type === type).length
            );
            
            vehiclesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: vehicleTypes,
                    datasets: [{
                        label: 'عدد المركبات',
                        data: vehicleCounts,
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.7)',
                            'rgba(231, 76, 60, 0.7)',
                            'rgba(46, 204, 113, 0.7)',
                            'rgba(155, 89, 182, 0.7)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // دوال إضافية للتبسيط (يمكن إكمالها لاحقاً)
        function addVehicle() { showToast('ميزة إضافة المركبة تحت التطوير', 'info'); }
        function saveSector() { showToast('ميزة إضافة القطاعات تحت التطوير', 'info'); }
        function saveRank() { showToast('ميزة إضافة الرتب تحت التطوير', 'info'); }
        function saveColor() { showToast('ميزة إضافة الألوان تحت التطوير', 'info'); }
        function addNewUser() { showToast('ميزة إضافة المستخدمين تحت التطوير', 'info'); }
        function editVehicle(id) { showToast('ميزة التعديل تحت التطوير', 'info'); }
        function deleteVehicle(id) { showToast('ميزة الحذف تحت التطوير', 'info'); }
        function openColorPicker(field) { showToast('ميزة اختيار الألوان تحت التطوير', 'info'); }
        function previewImage() { showToast('ميزة معاينة الصور تحت التطوير', 'info'); }
        function applyColor() { showToast('ميزة تطبيق الألوان تحت التطوير', 'info'); }
        function updateCommonColors() {}
        function updateSectorsTable() {}
        function updateRanksTable() {}
        function updateColorsList() {}
        function updateUsersTable() {}
        function resetVehicleForm() {}
        function resetSectorForm() {}
        function resetRankForm() {}
        function resetColorForm() {}

        // بداية التطبيق
        console.log('نظام البحث المتجاه للمركبات الشرطية - جاهز للعمل');
    </script>
</body>
</html>
